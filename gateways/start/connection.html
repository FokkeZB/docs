<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (!document.location.href.substr(0, document.location.href.length - document.location.hash.length).startsWith(canonical)) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/gateways/start/connection.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Gateway connection to TTN | The Things Network</title>
<meta name="generator" content="Jekyll v3.4.5" />
<meta property="og:title" content="Gateway connection to TTN" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Gateway connection to TTN" />
<meta property="og:description" content="Gateway connection to TTN" />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/gateways/start/connection.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/gateways/start/connection.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-22T15:51:07+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="twitter:title" content="Gateway connection to TTN" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"headline":"Gateway connection to TTN","dateModified":"2021-03-22T15:51:07+00:00","datePublished":"2021-03-22T15:51:07+00:00","description":"Gateway connection to TTN","url":"https://www.thethingsnetwork.org/docs/gateways/start/connection.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thethingsnetwork.org/docs/gateways/start/connection.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},"image":"https://www.thethingsnetwork.org/docs/assets/images/og-image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Tooltip">
    <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="header"></div>
    <div id="content">
<div class="layout-page">
  <!-- <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="⛅ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div> -->
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <!--<li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>-->
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class=""><a href="/docs/quick-start/">Quick Start</a></li>
                <li class=""><a href="/docs/lorawan/">LoRaWAN</a></li>
                <li class=""><a href="/docs/devices-and-gateways/">Devices & Gateways</a></li>
                <li class=""><a href="/docs/applications-and-integrations/">Applications</a></li>
                <li class=""><a href="/docs/the-things-stack/">The Things Stack</a></li>
                <li class=""><a href="/docs/v2-docs/">V2 docs</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/docs/edit/master/_content/gateways/start/connection.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>connection.md</strong></a>
      </div>
    </div>
    <div class="row wrapper">
      <div class="col-sm-3 side-nav">
        <div class="panel page-side-nav">
          <div class="panel-body">
            <ul>
              <li class=""><a href="/docs/gateways/index.html"><h5>Gateways</h5></a>
            <ul>
                <li class=""><a href="/docs/gateways/basics-station/">LoRa Basics™ Station</a>
                </li>
                <li class=""><a href="/docs/gateways/certificates/">Root Certificates</a>
                </li>
            </ul>
              </li>
            <li class="page-side-nav-section"><span>Running a gateway</span>
            <ul>
                <li class=""><a href="/docs/gateways/start/">Where to start</a>
            <ul>
                <li class=""><a href="/docs/gateways/start/build.html">Build your own gateway</a>
                </li>
                <li class="active"><a href="/docs/gateways/start/connection.html">Gateway connection to TTN</a>
                </li>
                <li class=""><a href="/docs/gateways/start/list.html">List of commercial gateways</a>
                </li>
                <li class=""><a href="/docs/gateways/start/single-channel.html">Single-channel gateways</a>
                </li>
            </ul>
                </li>
                <li class=""><a href="/docs/gateways/registration.html">Gateway Registration</a>
                </li>
                <li class=""><a href="/docs/gateways/packet-forwarder/">Packet Forwarders</a>
                </li>
                <li class=""><a href="/docs/gateways/lightning-protection.html">Lightning Protection</a>
                </li>
                <li class=""><a href="/docs/gateways/troubleshooting/">Troubleshooting</a>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Hardware</span>
            <ul>
                <li class=""><a href="/docs/gateways/thethingsindoor/">The Things Indoor Gateway</a>
                </li>
                <li class=""><a href="/docs/gateways/thethingsoutdoor/">The Things Outdoor Gateway</a>
                </li>
                <li class=""><a href="/docs/gateways/gateway/">The Things Gateway</a>
                </li>
                <li class=""><a href="/docs/gateways/multitech/">MultiTech Conduit</a>
                </li>
                <li class=""><a href="/docs/gateways/rak2245/">RAK2245 Pi Hat Edition - LoRaWAN® Gateway Concentrator Module</a>
                </li>
                <li class=""><a href="/docs/gateways/rak7243c/">RAK7243C Pilot Gateway</a>
                </li>
                <li class=""><a href="/docs/gateways/rak831/">RAK831</a>
                </li>
                <li class=""><a href="/docs/gateways/pisupply-hat/">Pi Supply Gateway HAT</a>
                </li>
                <li class=""><a href="/docs/gateways/aaeon/">AAEON</a>
                </li>
                <li class=""><a href="/docs/gateways/cisco/">Cisco LoRaWAN Gateway</a>
                </li>
                <li class=""><a href="/docs/gateways/kerlink/">Kerlink</a>
                </li>
                <li class=""><a href="/docs/gateways/laird/">Laird RG1xx</a>
                </li>
                <li class=""><a href="/docs/gateways/lorrier/">Lorrier LR2</a>
                </li>
                <li class=""><a href="/docs/gateways/mikrotik/">MikroTik Routerboard</a>
                </li>
                <li class=""><a href="/docs/gateways/st/">P-NUCLEO-LRWAN2</a>
                </li>
                <li class=""><a href="/docs/gateways/tektelic/">Tektelic</a>
                </li>
                <li class=""><a href="/docs/gateways/ursalink/">Ursalink</a>
                </li>
            </ul>
            </li>
            </ul>
            <!-- <li class="hidden-xs col-sm-2 page-toc page-affix"></li> --> 
          </div>
        </div> 
      </div>
      <div class="col-sm-9 page-body">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="gateway-connection-to-ttn">Gateway connection to TTN</h1>
<p>This page explains <strong>how packet forwarders exchange data with TTN</strong>. You don’t need to understand all of this to make a gateway work, but if you’re curious of how packet forwarders work, this can help you!</p>
<h2 id="the-things-network-router">The Things Network Router</h2>
<p>Packet forwarders connect to The Things Network through the <strong>router</strong> component. This component is tasked with <a href="https://github.com/TheThingsNetwork/ttn/tree/develop/core/router">handling gateway data and status</a>, and to transfer data to the rest of the network.</p>
<p><img src="connectors.png" alt="TTN Router" /></p>
<ul>
  <li>
    <p>For <strong>uplinks</strong>: the router receives uplinks from gateways, parses the uplink content for MAC payload and activations, computes new downlink windows, finds a broker to transmit the packet to, and transmits the uplink.</p>
  </li>
  <li>
    <p>For <strong>status messages</strong>: the router uses them to keep track of active gateways.</p>
  </li>
  <li>
    <p>For <strong>downlinks</strong>: the router receives a downlink from upstream, waits for a gateway to be available near the device, builds downlink options from the gateway options, and transmits it.</p>
  </li>
</ul>
<h2 id="protocols">Protocols</h2>
<p>Messages can be transmitted from a gateway to TTN through two protocols: the legacy Semtech UDP protocol, and our new Gateway Connector protocol.</p>
<h3 id="semtech-udp-protocol">Semtech UDP protocol</h3>
<p>The Semtech UDP protocol is, historically, the first gateway protocol that was developed for LoRaWAN. It was built by Semtech, who <a href="https://github.com/Lora-net/packet_forwarder">still maintain</a> it.</p>
<p>With this protocol, uplinks, statuses and downlinks are exchanged in a pseudo-JSON format, through UDP, between the gateway and the network server. Because of the simplicity of the messages and of the protocol, it is easy to reproduce this protocol, for testing purposes or for bootstrapping.</p>
<p>Because this protocol was implemented in the first packet forwarder publicly available, most gateways include a basic packet forwarder running this protocol.</p>
<h4 id="example">Example</h4>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rxpk"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"tmst"</span><span class="p">:</span><span class="mi">20900514000</span><span class="p">,</span><span class="w">
    </span><span class="nt">"chan"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rfch"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"freq"</span><span class="p">:</span><span class="mf">866.349812</span><span class="p">,</span><span class="w">
    </span><span class="nt">"stat"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modu"</span><span class="p">:</span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datr"</span><span class="p">:</span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"codr"</span><span class="p">:</span><span class="s2">"4/6"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rssi"</span><span class="p">:</span><span class="mi">-35</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lsnr"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"size"</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"AMy7qgAAAAAATYMmmnj6AADl6YP1Jrw"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p><em>Excerpt of a Semtech UDP message, with an uplink message - for example, <code class="highlighter-rouge">data</code> holds the payload, <code class="highlighter-rouge">tmst</code> the gateway time of reception, <code class="highlighter-rouge">rssi</code> the RSSI value…</em></p>
<h4 id="drawbacks-of-the-udp-protocol">Drawbacks of the UDP protocol</h4>
<p>However, this protocol lacks features for production-ready networks:</p>
<ul>
  <li>
    <p>It does not provide <strong>authentication</strong>. Gateways are supposed to identify themselves with their EUI - but anyone can usurpate another gateway.</p>
  </li>
  <li>
    <p>There is no <strong>encryption</strong> available. Gateway messages can be intercepted - and modified - during transport.</p>
  </li>
  <li>
    <p>Message exchange is not <strong>reliable</strong>, since the exchange is over 2-way UDP.</p>
  </li>
  <li>
    <p>The UDP protocol is based on a format close to JSON, but not fully compliant ; for example, the specs specify that an object can hold multiple properties with the same index. This makes it easy to write by hand for testing purposes, but difficult to parse in some situations.</p>
  </li>
</ul>
<h3 id="gateway-connector-protocol">Gateway connector protocol</h3>
<p>Because of the reasons above, we’ve developed a new protocol, solving these issues: the <strong>gateway connector protocol</strong>. With this protocol:</p>
<ul>
  <li>
    <p>Gateways are identified by an <strong>ID</strong> and by a <strong>key</strong>. Sending a message to a router requires to know the combination.</p>
  </li>
  <li>
    <p>Messages are sent encoded in <strong><a href="https://developers.google.com/protocol-buffers/">protocol buffers</a></strong>. This serialisation technology allows transfer of data from a program to another, in native types, <strong>regardless of the language</strong>.</p>
  </li>
</ul>
<p>With the gateway connector protocol, messages can be exchanged through two network protocols:</p>
<ul>
  <li>
    <p>If your hardware and software supports it, through <a href="https://grpc.io">gRPC</a>, which supports protocol buffers natively. gRPC supports TLS encryption natively.</p>
  </li>
  <li>
    <p>Otherwise, protocol buffer-encoded messages can be sent through MQTT. MQTTS, a variant of MQTT, enforces TLS encryption.</p>
  </li>
</ul>
<h4 id="using-the-gateway-connector-protocol">Using the gateway connector protocol</h4>
<p>Using the gateway connector protocol to send messages happens in two steps:</p>
<ul>
  <li>
    <p>First, you need to obtain the <strong>type files</strong>, in your programming language, generated from the protocol buffer files. Both the protocol buffer files and pre-generated files for some languages can be found <a href="https://github.com/TheThingsNetwork/api">here</a> - if your language isn’t in the repository, you can look up how to generate code for your language <a href="https://developers.google.com/protocol-buffers/docs/reference/overview">in the official protocol buffer documentation</a>. With these type files, you can start building messages in these types.</p>
  </li>
  <li>
    <p>The second step is sending them over to The Things Network. You’ll need to identify yourself (using the gateway ID and gateway key) to the account server to obtain a token, then send messages to the router with this token.</p>
  </li>
</ul>
<h4 id="example-using-grpc">Example using gRPC</h4>
<p>In this example built in the Go language, we’ll show two functions:</p>
<ul>
  <li>The first one, <code class="highlighter-rouge">createUplinkMessage</code>, <strong>builds an uplink message</strong> in the protocol-buffer generated types ;</li>
  <li>The second function, <code class="highlighter-rouge">connectAndSendUplink</code>, <strong>sends an uplink</strong> to The Things Network over <strong>gRPC</strong>.</li>
</ul>
<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
  </span><span class="s">"github.com/TheThingsNetwork/go-account-lib/account"</span><span class="x">
  </span><span class="s">"github.com/TheThingsNetwork/api/discovery"</span><span class="x">
  </span><span class="s">"github.com/TheThingsNetwork/api/gateway"</span><span class="x">
  </span><span class="s">"github.com/TheThingsNetwork/api/protocol"</span><span class="x">
  </span><span class="s">"github.com/TheThingsNetwork/api/protocol/lorawan"</span><span class="x">
  </span><span class="s">"github.com/TheThingsNetwork/api/router"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">const</span><span class="x"> </span><span class="p">(</span><span class="x">
  </span><span class="n">gatewayID</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"INSERT_GATEWAY_ID"</span><span class="x">
  </span><span class="n">gatewayKey</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"INSERT_GATEWAY_KEY"</span><span class="x">

  </span><span class="n">accountServer</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"https://account.thethingsnetwork.org"</span><span class="x">
  </span><span class="n">discoveryServer</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"discovery.thethings.network:1900"</span><span class="x">
  </span><span class="n">routerID</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"ttn-router-eu"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">createUplinkMessage</span><span class="p">(</span><span class="n">payload</span><span class="x"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="x"> </span><span class="o">*</span><span class="n">router</span><span class="o">.</span><span class="n">UplinkMessage</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="c">// Creating a dummy uplink message, using the protocol buffer-generated types</span><span class="x">
  </span><span class="k">return</span><span class="x"> </span><span class="o">&amp;</span><span class="n">router</span><span class="o">.</span><span class="n">UplinkMessage</span><span class="p">{</span><span class="x">
    </span><span class="n">GatewayMetadata</span><span class="o">:</span><span class="x"> </span><span class="o">&amp;</span><span class="n">gateway</span><span class="o">.</span><span class="n">RxMetadata</span><span class="p">{</span><span class="x">
      </span><span class="n">Rssi</span><span class="o">:</span><span class="x"> </span><span class="o">-</span><span class="m">35</span><span class="p">,</span><span class="x">
      </span><span class="n">Snr</span><span class="o">:</span><span class="x">  </span><span class="m">5</span><span class="p">,</span><span class="x">
    </span><span class="p">},</span><span class="x">
    </span><span class="n">Payload</span><span class="o">:</span><span class="x"> </span><span class="n">payload</span><span class="p">,</span><span class="x">
    </span><span class="n">ProtocolMetadata</span><span class="o">:</span><span class="x"> </span><span class="o">&amp;</span><span class="n">protocol</span><span class="o">.</span><span class="n">RxMetadata</span><span class="p">{</span><span class="x">
      </span><span class="n">Protocol</span><span class="o">:</span><span class="x"> </span><span class="o">&amp;</span><span class="n">protocol</span><span class="o">.</span><span class="n">RxMetadata_Lorawan</span><span class="p">{</span><span class="x">
        </span><span class="n">Lorawan</span><span class="o">:</span><span class="x"> </span><span class="o">&amp;</span><span class="n">lorawan</span><span class="o">.</span><span class="n">Metadata</span><span class="p">{</span><span class="x">
          </span><span class="n">CodingRate</span><span class="o">:</span><span class="x"> </span><span class="s">"4/5"</span><span class="p">,</span><span class="x">
          </span><span class="n">DataRate</span><span class="o">:</span><span class="x">   </span><span class="s">"SF7BW125"</span><span class="p">,</span><span class="x">
          </span><span class="n">Modulation</span><span class="o">:</span><span class="x"> </span><span class="n">lorawan</span><span class="o">.</span><span class="n">Modulation_LORA</span><span class="p">,</span><span class="x">
        </span><span class="p">},</span><span class="x">
      </span><span class="p">},</span><span class="x">
    </span><span class="p">},</span><span class="x">
  </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">connectAndSendUplink</span><span class="p">(</span><span class="n">uplink</span><span class="x"> </span><span class="o">*</span><span class="n">router</span><span class="o">.</span><span class="n">UplinkMessage</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="c">// Connecting to the TTN account server to fetch a token</span><span class="x">
  </span><span class="n">gwAccount</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">account</span><span class="o">.</span><span class="n">NewWithKey</span><span class="p">(</span><span class="n">accountServer</span><span class="p">,</span><span class="x"> </span><span class="n">gatewayKey</span><span class="p">)</span><span class="x">
  </span><span class="n">gw</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">gwAccount</span><span class="o">.</span><span class="n">FindGateway</span><span class="p">(</span><span class="n">gatewayID</span><span class="p">)</span><span class="x">
  </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">err</span><span class="x">
  </span><span class="p">}</span><span class="x">
  </span><span class="n">token</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">gw</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">AccessToken</span><span class="x">

  </span><span class="c">// Connecting to the TTN discovery server to get a connection to the router</span><span class="x">
  </span><span class="n">discoveryClient</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">discovery</span><span class="o">.</span><span class="n">NewClient</span><span class="p">(</span><span class="n">discoveryServer</span><span class="p">,</span><span class="x"> </span><span class="o">&amp;</span><span class="n">discovery</span><span class="o">.</span><span class="n">Announcement</span><span class="p">{</span><span class="n">Id</span><span class="o">:</span><span class="x"> </span><span class="n">gatewayID</span><span class="p">},</span><span class="x"> </span><span class="k">func</span><span class="p">()</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x"> </span><span class="k">return</span><span class="x"> </span><span class="s">""</span><span class="x"> </span><span class="p">})</span><span class="x">
  </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">err</span><span class="x">
  </span><span class="p">}</span><span class="x">

  </span><span class="c">// Connecting to the router</span><span class="x">
  </span><span class="n">routerAccess</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">discoveryClient</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"router"</span><span class="p">,</span><span class="x"> </span><span class="n">routerID</span><span class="p">)</span><span class="x">
  </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">err</span><span class="x">
  </span><span class="p">}</span><span class="x">

  </span><span class="n">routerConn</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">routerAccess</span><span class="o">.</span><span class="n">Dial</span><span class="p">()</span><span class="x">
  </span><span class="n">routerClient</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">router</span><span class="o">.</span><span class="n">NewRouterClientForGateway</span><span class="p">(</span><span class="n">router</span><span class="o">.</span><span class="n">NewRouterClient</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">routerConn</span><span class="p">),</span><span class="x"> </span><span class="n">gatewayID</span><span class="p">,</span><span class="x"> </span><span class="n">token</span><span class="p">)</span><span class="x">
  </span><span class="n">uplinkStream</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">router</span><span class="o">.</span><span class="n">NewMonitoredUplinkStream</span><span class="p">(</span><span class="n">routerClient</span><span class="p">)</span><span class="x">

  </span><span class="c">// Sending the uplink</span><span class="x">
  </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">uplinkStream</span><span class="o">.</span><span class="n">Send</span><span class="p">(</span><span class="n">uplink</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">err</span><span class="x">
  </span><span class="p">}</span><span class="x">
  </span><span class="c">// Uplink sent successfully!</span><span class="x">
  </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>
          </div>  
        </div>
        <div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ttn-components.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-navbar.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-footer.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
  </body>
</html>
