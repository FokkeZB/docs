<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (!document.location.href.substr(0, document.location.href.length - document.location.hash.length).startsWith(canonical)) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/devices/arduino/usage.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Library Usage | The Things Network</title>
<meta name="generator" content="Jekyll v3.4.5" />
<meta property="og:title" content="Library Usage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Library Usage Here’s how you include and use The Things Network library. Also have a look at the examples bundled with the library. You can find them in the Arduino IDE under File &gt; Examples &gt; TheThingsNetwork." />
<meta property="og:description" content="Library Usage Here’s how you include and use The Things Network library. Also have a look at the examples bundled with the library. You can find them in the Arduino IDE under File &gt; Examples &gt; TheThingsNetwork." />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/devices/arduino/usage.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/devices/arduino/usage.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-23T12:55:33+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="twitter:title" content="Library Usage" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"headline":"Library Usage","dateModified":"2021-03-23T12:55:33+00:00","datePublished":"2021-03-23T12:55:33+00:00","description":"Library Usage Here’s how you include and use The Things Network library. Also have a look at the examples bundled with the library. You can find them in the Arduino IDE under File &gt; Examples &gt; TheThingsNetwork.","url":"https://www.thethingsnetwork.org/docs/devices/arduino/usage.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thethingsnetwork.org/docs/devices/arduino/usage.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},"image":"https://www.thethingsnetwork.org/docs/assets/images/og-image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Tooltip">
    <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="header"></div>
    <div id="content">
<div class="layout-page">
  <!-- <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="⛅ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div> -->
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <!--<li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>-->
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class=""><a href="/docs/quick-start/">Quick Start</a></li>
                <li class=""><a href="/docs/lorawan/">LoRaWAN</a></li>
                <li class=""><a href="/docs/devices-and-gateways/">Devices & Gateways</a></li>
                <li class=""><a href="/docs/applications-and-integrations/">Applications</a></li>
                <li class=""><a href="/docs/the-things-stack/">The Things Stack</a></li>
                <li class=""><a href="/docs/v2-docs/">V2 docs</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/docs/edit/master/_content/devices/arduino/usage.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>usage.md</strong></a>
      </div>
    </div>
    <div class="row wrapper">
      <div class="col-sm-3 side-nav">
        <div class="panel page-side-nav">
          <div class="panel-body">
            <ul>
              <li class=""><a href="/docs/devices/index.html"><h5>Devices</h5></a>
            <ul>
                <li class=""><a href="/docs/devices/registration.html">Device Registration</a>
                </li>
                <li class=""><a href="/docs/devices/bytes.html">Working with Bytes</a>
                </li>
                <li class=""><a href="/docs/devices/bestpractices.html">Best Practices</a>
                </li>
            </ul>
              </li>
            <li class="page-side-nav-section"><span>SDKs & Libraries</span>
            <ul>
                <li class=""><a href="/docs/devices/arduino/">Arduino</a>
            <ul>
                <li class=""><a href="/docs/devices/arduino/ide.html">IDE Setup & Usage</a>
                </li>
                <li class="active"><a href="/docs/devices/arduino/usage.html">Library Usage</a>
                </li>
                <li class=""><a href="/docs/devices/arduino/api/network.html">API Reference</a>
                    <i class="fa fa-link"></i>
                </li>
            </ul>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Hardware</span>
            <ul>
                <li class=""><a href="/docs/devices/uno/">The Things Uno</a>
                </li>
                <li class=""><a href="/docs/devices/rak5205-wistrio-lora-tracker/">RAK5205 WisTrio LoRa® Tracker</a>
                </li>
                <li class=""><a href="/docs/devices/rak7200-lora-tracker/">RAK7200 LoRa® Tracker</a>
                </li>
                <li class=""><a href="/docs/devices/rak811-lora-module-breakout-board/">RAK811 LoRa® Breakout Module</a>
                </li>
                <li class=""><a href="/docs/devices/rak811-lora-evaluation-board/">RAK811 LoRa® Evaluation Board</a>
                </li>
                <li class=""><a href="/docs/devices/rak811-wisnode-lora-module/">RAK811 WisNode LoRa Module</a>
                </li>
                <li class=""><a href="/docs/devices/node/">The Things Node</a>
                </li>
                <li class=""><a href="/docs/devices/lopy/">LoPy</a>
                </li>
            </ul>
            </li>
            </ul>
            <!-- <li class="hidden-xs col-sm-2 page-toc page-affix"></li> --> 
          </div>
        </div> 
      </div>
      <div class="col-sm-9 page-body">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="library-usage">Library Usage</h1>
<p>Here’s how you include and use The Things Network library. Also have a look at the examples bundled with the library. You can find them in the Arduino IDE under <strong>File &gt; Examples &gt; <a href="https://github.com/TheThingsNetwork/arduino-device-lib/tree/master/examples">TheThingsNetwork</a></strong>.</p>
<h2 id="include">Include</h2>
<p>To use the library:</p>
<ol>
  <li>Follow <a href="ide.html#setup">setup</a> to install the library in Arduino IDE.</li>
  <li>
    <p>Select <strong>Sketch &gt; Include Library &gt; TheThingsNetwork</strong> to include it.</p>
    <p>Or simply copy and paste:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span></code></pre>
    </div>
  </li>
</ol>
<h2 id="initialize">Initialize</h2>
<p>A typical sketch has the following structure:</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span>
<span class="c1">// OTAA or ABP keys
// ..
</span>
<span class="cp">#define loraSerial Serial1
#define debugSerial Serial
</span>
<span class="c1">// Replace REPLACE_ME with TTN_FP_EU868 or TTN_FP_US915
</span><span class="cp">#define freqPlan REPLACE_ME
</span>
<span class="n">TheThingsNetwork</span> <span class="n">ttn</span><span class="p">(</span><span class="n">loraSerial</span><span class="p">,</span> <span class="n">debugSerial</span><span class="p">,</span> <span class="n">freqPlan</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">loraSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">57600</span><span class="p">);</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>

  <span class="c1">// OTAA or ABP activation
</span>  <span class="c1">// ..
</span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// Send and receive messages
</span>  <span class="c1">// ..
</span><span class="p">}</span>
</code></pre>
</div>
<p>The actual streams you’d pass to the constructor depend on the board you use and the Serial Port you connected a LoRaWAN module to. For The Things Uno and Node use the Serial Ports and baud rates shown here. For other devices see the notes about serial ports at the end of this document.</p>
<h3 id="set-the-frequency-plan">Set the frequency plan</h3>
<p>The third argument for the constructor is a constant to set the frequency plan your device operates on. Replace <code class="highlighter-rouge">REPLACE_ME</code> with one of the lines below, depending on the frequency plan of your device and your country. (Click <a href="https://www.thethingsnetwork.org/docs/lorawan/frequencies-by-country.html">here</a> for an overview of all frequency plans per country).</p>
<ul>
  <li><code class="highlighter-rouge">TTN_FP_EU868</code> (Europe, Middle East, Africa)</li>
  <li><code class="highlighter-rouge">TTN_FP_US915</code> (Americas, except Brazil)</li>
  <li><code class="highlighter-rouge">TTN_FP_AU915</code> (Oceania, Brazil)</li>
  <li><code class="highlighter-rouge">TTN_FP_IN865_867</code> (India)</li>
  <li><code class="highlighter-rouge">TTN_FP_KR920_923</code> (Korea)</li>
  <li><code class="highlighter-rouge">TTN_FP_AS920_923</code> (Japan, Singapore, Malaysia)</li>
  <li><code class="highlighter-rouge">TTN_FP_AS923_925</code> (Southeast Asia)</li>
</ul>
<h2 id="activate">Activate</h2>
<p>In the <a href="https://www.arduino.cc/en/Reference/setup"><code class="highlighter-rouge">setup()</code></a> function, after initializing the library, we have to activate the device.</p>
<p>There are two ways to activate your device. By default your device is registered to use OTAA. You can also personalise a device to use ABP.</p>
<h3 id="over-the-air-activation-otaa">Over The Air Activation (OTAA)</h3>
<p>For OTAA you will use the <code class="highlighter-rouge">join()</code> method with the <strong>App EUI</strong> and <strong>App Key</strong> configured for your device.</p>
<ol>
  <li>
    <p>Right after the include for the library create constants to hold the keys:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appEui</span> <span class="o">=</span> <span class="s">"0000000000000000"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appKey</span> <span class="o">=</span> <span class="s">"00000000000000000000000000000000"</span><span class="p">;</span>
</code></pre>
    </div>
    <ul>
      <li>For <code class="highlighter-rouge">appEui</code> use the <strong>Application EUI</strong> found on the device’s page in the console. Click <i class="ion-clipboard"></i> to copy.</li>
      <li>For <code class="highlighter-rouge">appKey</code> use the <strong>App Key</strong>.</li>
    </ul>
    <p>Alternatively, scroll down the device page to copy past the full snippet:</p>
    <p><img src="keys-otaa.png" alt="OTAA Keys" /></p>
  </li>
  <li>
    <p>In your <code class="highlighter-rouge">setup()</code> function, call <code class="highlighter-rouge">ttn.join()</code> with the constants you just created:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">ttn</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">appEui</span><span class="p">,</span> <span class="n">appKey</span><span class="p">);</span>
</code></pre>
    </div>
  </li>
</ol>
<p>Your device will now try to get a confirmed activation via OTAA every 10 seconds until it succeeds.</p>
<h3 id="activation-by-personalization-abp">Activation By Personalization (ABP)</h3>
<p>For ABP you will use the <code class="highlighter-rouge">personalize()</code> method with the device’s <strong>Device EUI</strong>, <strong>Network Session Key</strong> and <strong>App Session Key</strong>.</p>
<ol>
  <li>
    <p>Right after the include for the library create constants to hold the keys:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">devAddr</span> <span class="o">=</span> <span class="s">"00000000"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">nwkSKey</span> <span class="o">=</span> <span class="s">"00000000000000000000000000000000"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appSKey</span> <span class="o">=</span> <span class="s">"00000000000000000000000000000000"</span><span class="p">;</span>
</code></pre>
    </div>
    <ul>
      <li>For <code class="highlighter-rouge">devAddr </code> use the <strong>Device Address</strong> found on the device’s page in the console. Click <i class="ion-clipboard"></i> to copy.</li>
      <li>For <code class="highlighter-rouge">nwkSKey </code> use the <strong>Network Session Key</strong>.</li>
      <li>For <code class="highlighter-rouge">appSKey</code> use <strong>App Session Key</strong>.</li>
    </ul>
    <p>Alternatively, scroll down the device page to copy past the full snippet:</p>
    <p><img src="keys-abp.png" alt="ABP Keys" /></p>
  </li>
  <li>
    <p>In your <code class="highlighter-rouge">setup()</code> function, call <code class="highlighter-rouge">ttn.personalize()</code> with the constants you just created:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">ttn</span><span class="p">.</span><span class="n">personalize</span><span class="p">(</span><span class="n">devAddr</span><span class="p">,</span> <span class="n">nwkSKey</span><span class="p">,</span> <span class="n">appSKey</span><span class="p">);</span>
</code></pre>
    </div>
  </li>
</ol>
<p>Your device will now communicate with the network using these keys.</p>
<p>Also see <strong>File &gt; Examples &gt; TheThingsNetwork &gt; <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/ABP/ABP.ino">ABP</a></strong>.</p>
<h2 id="send">Send</h2>
<p>To send messages call <code class="highlighter-rouge">ttn.sendBytes()</code> with an array of bytes and its size. Here’s an example of a <code class="highlighter-rouge">loop()</code> function that sends the current state of <a href="https://www.arduino.cc/en/Reference/Constants"><code class="highlighter-rouge">LED_BUILTIN</code></a> every 10 seconds:</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">byte</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">)</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    
  <span class="n">ttn</span><span class="p">.</span><span class="n">sendBytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
  
  <span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p>To minimise your use of the limited daily airtime try to use as little bytes as possible. See <a href="../bytes.html">Working with Bytes</a> for more information.</p>
<p>Also see <strong>File &gt; Examples &gt; TheThingsNetwork &gt; <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/Send/Send.ino">Send</a></strong>.</p>
<h2 id="receive">Receive</h2>
<p>The most common <a href="https://www.lora-alliance.org/What-Is-LoRa/Technology">Class A</a> LoRaWAN devices - including The Things Node and Uno - can only receive the last scheduled message in response to a message they send.</p>
<blockquote>
  <p>For your convenience, the library has a <code class="highlighter-rouge">ttn.poll()</code> method which sends a single byte to poll for incoming messages, if you don’t have anything particular to send.</p>
</blockquote>
<p>To receive message you have to define a function and pass it to the library.</p>
<ol>
  <li>
    <p>Add the following function to your sketch:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">message</span><span class="p">(</span><span class="k">const</span> <span class="n">byte</span><span class="o">*</span> <span class="n">payload</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="n">port_t</span> <span class="n">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"-- MESSAGE"</span><span class="p">);</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Received "</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="s">" bytes on port "</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span> <span class="s">":"</span><span class="p">);</span>
    
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">debugSerial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
  <span class="p">}</span>
    
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Register the function in your <code class="highlighter-rouge">setup()</code> function:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">ttn</span><span class="p">.</span><span class="n">onMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</code></pre>
    </div>
  </li>
</ol>
<p>Also see <strong>File &gt; Examples &gt; TheThingsNetwork &gt; <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/Receive/Receive.ino">Receive</a></strong>.</p>
<h1 id="notes">Notes</h1>
<h2 id="serial-ports">Serial ports</h2>
<p>The RN2483 and RN2903 make use of a serial interface to communicate with your device’s main processor. Serial interfaces are similar to the RS232 serial port on older computers. The most microcontrollers have hardware Universal Asynchronous Receiver/Transmitters (UARTs) or also called HardwareSerial ports. Serial communication is offloaded to these UARTs so that the main processor does not have to waste time on this slow task. A UART can only support one serial interface at a time, and most processors only have one or two UARTs. Therefore if you already used the available UARTs to communicate with, for example, your computer and a GPS, you do not have any left for the RN2483/RN2903.</p>
<p>When you run out of UARTs, you can still use serial communication handled in software. In this case it is not offloaded to dedicated hardware, and the main processor needs to handle the communication. This is called Software Serial. Depending on how the software serial is implemented, you can have as many as you want, as long as you have free GPIO pins on your device. Note that not all GPIO pins support all types of software serial. Examples of software serial is the default Arduino <a href="https://www.arduino.cc/en/Reference/SoftwareSerial">SoftwareSerial</a> library, and the <a href="https://www.pjrc.com/teensy/td_libs_AltSoftSerial.html">AltSoftSerial</a> library.</p>
<p>Serial communication uses high and low voltages to signal ones and zeros. The RN2483/RN2903 runs on 3.3V, which means a one is represented as a 3.3V level on the communication line, and a 0 is a 0V level on the line. Because the most Arduinos run at 5V, they expect a one to be represented by a 5V level on the line. Therefore when and Arduino sees a 3.3V signal, it causes an ambiguity. If you are lucky it works fine, but it is out of specification. To connect an RN2483/RN2903 to a 5V Arduino, you will need to include a level shifter.</p>
<h3 id="stream-objects">Stream objects</h3>
<p>In the Arduino world serial ports are abstracted as stream objects. All stream objects have the same functions, even if lower down they use different physical connections (UART, SoftwareSerial, AltSoftSerial). This library does not care what you use, as long as it extends the Stream object.</p>
<p>The Stream objects need to be initialized at the correct baud rates at the start of your <code class="highlighter-rouge">setup()</code> function. See <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples">our examples</a> for more details. For example:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>  loraSerial.begin(57600);
  debugSerial.begin(9600);
</code></pre>
</div>
<h3 id="thethingsuno">TheThingsUno</h3>
<p>TheThingsUno is basically the same as an Arduino Leonardo with Serial1 connected to the RN2483/RN2903. Therefore if you use an Arduino Leonardo, and connect your RN2483/RN2903 to the Serial1 pins, you can use the same configuration than for TheThingsUno.</p>
<p>At the top of your sketch use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>#define loraSerial Serial1
#define debugSerial Serial
</code></pre>
</div>
<p>And in your <code class="highlighter-rouge">setup()</code> function use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>void setup()
{
  loraSerial.begin(57600);
  debugSerial.begin(9600);
  ...
}
</code></pre>
</div>
<h3 id="sodaq-one">SODAQ One</h3>
<p>At the top of your sketch use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>#define loraSerial Serial1
#define debugSerial SerialUSB
</code></pre>
</div>
<p>And in your <code class="highlighter-rouge">setup()</code> function use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>void setup()
{
  loraSerial.begin(57600);
  debugSerial.begin(9600);
  ...
}
</code></pre>
</div>
<h3 id="arduino-uno-arduino-nano-or-other-devices-using-softwareserial">Arduino Uno, Arduino Nano or other devices using SoftwareSerial</h3>
<p>The Arduino Uno only has one hardware serial port which is used to communicate over USB to the computer. When connecting an RN2483/RN2903 to the Arduino Uno, one has to make use of SoftwareSerial. If you connected the RN2483/RN2903 to the Arduino using the same pinout as <a href="https://www.thethingsnetwork.org/forum/t/how-to-build-your-first-ttn-node-arduino-rn2483/1574">described on the forum</a>, you can make use of the following code.</p>
<p>At the top of your sketch use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>#include &lt;SoftwareSerial.h&gt;

#define debugSerial Serial

SoftwareSerial loraSerial(10, 11); // RX, TX
</code></pre>
</div>
<p>And in your <code class="highlighter-rouge">setup()</code> function use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>void setup()
{
  loraSerial.begin(9600);
  debugSerial.begin(9600);
  ...
}
</code></pre>
</div>
<p>SoftwareSerial does not operate correctly at high baud rates. We normally use it at 9600 baud. Because the RN2483 and RN2903 normally operates at 57600 baud, we need to switch it to 9600 baud so that we can communicate with it using 9600 baud. This is done automatically inside TheThingsNetwork Arduino library. Changing of the baud rate of the RN2483/RN2903 is not always very reliable. Power cycling the device, or a reset, might be necessary.</p>
<p>If you connected the RN2483/RN2903 to different pins on the Arduino, you can change the line <code class="highlighter-rouge">SoftwareSerial loraSerial(10, 11); // RX, TX</code> to specify the correct RX and TX pins (from the Arduino’s perspective).</p>
<p>When using the <a href="https://github.com/PaulStoffregen/AltSoftSerial">AltSoftSerial</a> library the pins you can use for software serial is fixed according to which device you use. You therefore do not have a choice which pins to use, and you may lose some other functionality, but this library seems to be more stable than the default SoftwareSerial library. Both are however usable with TheThingsNetwork library.</p>
          </div>  
        </div>
        <div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ttn-components.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-navbar.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-footer.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
  </body>
</html>
