---
title: Message Types
section: Fundamental
---

<p style="color: red; font-weight: bold">>>>>>  gd2md-html alert:  ERRORs: 0; WARNINGs: 0; ALERTS: 1.</p>
<ul style="color: red; font-weight: bold"><li>See top comment block for details on ERRORs and WARNINGs. <li>In the converted Markdown or HTML, search for inline alerts that start with >>>>>  gd2md-html alert:  for specific instances that need correction.</ul>

<p style="color: red; font-weight: bold">Links to alert messages:</p><a href="#gdcalert1">alert1</a>

<p style="color: red; font-weight: bold">>>>>> PLEASE check and correct alert issues and delete this message and the inline alerts.<hr></p>



## Message Types

In this chapter, you will learn about different message types used in LoRaWAN. These message types are used to transport application-specific data and MAC commands. The Things Fundamentals certification exam expects you should have basic knowledge on the following topics with regards to the message types:



*   MAC Message types and their uses.
*   Transporting MAC commands in **FOpts **field.
*   Transporting MAC commands and **application payloads** in **FRMPayload **field.
*   Knowing  the keys used to encrypt each message field that carries **MAC Commands** and **application payloads**.
*   Knowing the keys used to calculate the **MIC **of each message.


## MAC Massage Types

LoRaWAN defines several MAC message types. 



*   LoRaWAN 1.0.x uses **7** MAC message types.
*   LoRaWAN 1.1 uses **8** MAC message types. 

The following table presents MAC message types that can be found in LoRaWAN 1.0.x and 1.1. 

Table: MAC message types in LoRaWAN 1.0.x and 1.1


<table>
  <tr>
   <td><strong>LoRaWAN 1.0.x</strong>
   </td>
   <td><strong>LoRaWAN 1.1</strong>
   </td>
   <td><strong>Description</strong>
   </td>
  </tr>
  <tr>
   <td>Join-request
   </td>
   <td>Join-request
   </td>
   <td>Uplink OTAA join request
   </td>
  </tr>
  <tr>
   <td>Join-accept
   </td>
   <td>Join-accept
   </td>
   <td>Downlink OTAA join-accept
   </td>
  </tr>
  <tr>
   <td>Unconfirmed Data Up
   </td>
   <td>Unconfirmed Data Up
   </td>
   <td>Uplink data frame, confirmation not required
   </td>
  </tr>
  <tr>
   <td>Unconfirmed Data Down
   </td>
   <td>Unconfirmed Data Down
   </td>
   <td>Downlink data frame, confirmation not required
   </td>
  </tr>
  <tr>
   <td>Confirmed Data Up
   </td>
   <td>Confirmed Data Up
   </td>
   <td>Uplink data frame, confirmation requested
   </td>
  </tr>
  <tr>
   <td>Confirmed Data Down
   </td>
   <td>Confirmed Data Down
   </td>
   <td>Downlink data frame, confirmation requested
   </td>
  </tr>
  <tr>
   <td>RFU
   </td>
   <td>Rejoin-request
   </td>
   <td>1.0.x - Reserved for Future usage
<p>
1.1 - Uplink OTAA rejoin request
   </td>
  </tr>
  <tr>
   <td>Proprietary
   </td>
   <td>Proprietary
   </td>
   <td>Used to implement non-standard message formats
   </td>
  </tr>
</table>



### Join-request, Rejoin-request, and Join-accept messages

In** LoRaWAN 1.0.x**, **two **MAC messages are used by the Over-The-Air-Activation (OTAA) procedure. They are,



*   Join-request
*   Join-accept

In **LoRaWAN 1.1**, **three **MAC messages are used by the  Over-The-Air-Activation (OTAA) procedure and for roaming purposes. They are,



*   Join-request
*   Rejoin-request
*   Join-accept

The **join-request** message is always initiated by an **end device** and sent to the **network server**. In LoRaWAN versions earlier than 1.0.4 the Join-request message is forwarded by the **Network Server** to the **Application Server**. In LoRaWAN 1.1 and 1.0.4+,  the **network server **forwards the join-request message to the device’s **Join Server**. The **join-request **message is not encrypted and is sent as plain text.

In LoRaWAN versions earlier than 1.0.4 the join-accept message is generated by the application server. In LoRaWAN 1.1 and 1.0.4+ the Join-accept message is generated by the Join Server. In both cases the message passes through the Network Server. Then the Network Server routes the Join-accept message to the correct end-device. The **join-accept** message is encrypted as follows.



*   In **LoRaWAN 1.0**, the **join-accept** message is encrypted with the **AppKey**.
*   In **LoRaWAN 1.1**, the **join-accept **message is encrypted depending on the **join-reques**t or **rejoin-request** as shown in the table below.

<table>
  <tr>
   <td>
<strong>Triggering Join-request or Rejoin-request type</strong>
   </td>
   <td><strong>Join-accept encryption key</strong>
   </td>
  </tr>
  <tr>
   <td>Join-request
   </td>
   <td>NwkKey
   </td>
  </tr>
  <tr>
   <td>Rejoin-request (for all types)
   </td>
   <td>JSEncKey
   </td>
  </tr>
</table>


The **rejoin-request** message is always initiated by an end device and sent to the network server. There are three types of rejoin-requests messages; Type 0, 1, and 2. These messages are used to initialize the new session context for the end device. For rejoin-request messages, the network replies with a join-accept message. The **rejoin-request **messages are not encrypted but integrity protected with the Message Integrity Code (MIC). You will learn in detail about the join-request, join-accept, and rejoin-request messages in Chapter ‘End Device Activation’.


### Data Messages

There are 4 data message types used in both LoRaWAN **1.0.x** and **1.1**. These data message types are used to transport both MAC commands and application data which can be combined together in a single message. Data messages can be confirmed or unconfirmed. The confirmed data messages must be acknowledged by the receiver whereas unconfirmed data messages do not need to be acknowledged by the receiver.

A data message is constructed step-by-step at different layers as shown below:



<p id="gdcalert1" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image1.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert2">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image1.png "image_tooltip")




*   The MAC payload of the data messages consists of a **frame header **(FHDR) followed by an optional **port field** (FPort) and an optional **frame payload** (FRMPayload).

<table>
  <tr>
   <td>
7 to 22 bytes
   </td>
   <td>0 to 1 byte
   </td>
   <td>0 to N bytes
   </td>
  </tr>
  <tr>
   <td>FHDR
   </td>
   <td>FPort
   </td>
   <td>FRMPayload
   </td>
  </tr>
</table>




*   The **frame header (FHDR)** of the **MAC payload** consists of the following fields.

<table>
  <tr>
   <td>
4 bytes
   </td>
   <td>1 byte
   </td>
   <td>2 bytes
   </td>
   <td>0 to 15 bytes
   </td>
  </tr>
  <tr>
   <td>DevAddr
   </td>
   <td>FCtrl
   </td>
   <td>FCnt
   </td>
   <td>FOpts
   </td>
  </tr>
</table>


The maximum length (**M**) of the** MACPayload **field is region and data rate specific and can be found in the chapter ‘Regional Parameters’. 


## Transporting MAC Commands and Application-Specific Data

The **MAC commands** can be transported in the **FOpts **field or **FRMPayload **field of a **data message** but not simultaneously.


### Transporting MAC Commands in FOpts Field

The **FOpts **field can be used to transport MAC commands that are piggybacked onto the data frame. The FOpts field can contain any sequence of MAC commands and must not exceed 15 octets as shown in the following image. If the length of the **FOpts **field is 0 (can be found in the **FOptsLen **field of the **FCtrl **field), the FOpts field is absent.


<table>
  <tr>
   <td colspan="3" ><em>←15 bytes (octets) max→ </em>
   </td>
  </tr>
  <tr>
   <td><em>8 to 40 bytes</em>
   </td>
   <td><em>...</em>
   </td>
   <td><em>8 to 40 bytes</em>
   </td>
  </tr>
  <tr>
   <td>MAC Command 1
   </td>
   <td>...
   </td>
   <td>MAC Command n
   </td>
  </tr>
</table>




*   In LoRaWAN 1.0.x, these piggybacked MAC commands are always sent without encryption. 
*   In LoRaWAN 1.1, these piggybacked MAC commands are always sent encrypted by encrypting the FOpts field using NwkSEncKey.


### Transporting MAC Commands and Application-specific data in FRMPayload field

The **FRMPayload** field can contain **Application payload** or **MAC Commands**. If the **FRMPayload **field is not empty, the **FPort **must be present. If the FPort is present, the **FPort **value 0 indicates that the **FRMPayload **contains MAC commands only and also the **FPort **value 1 indicates that the **FRMPayload **field contains Application payload. 

The following table presents the values the **FPort **field can have.

Table: FPort field values.


<table>
  <tr>
   <td><strong>FPort Value</strong>
   </td>
   <td><strong>Description</strong>
   </td>
  </tr>
  <tr>
   <td>0
   </td>
   <td>MAC commands only
   </td>
  </tr>
  <tr>
   <td>1 to 223
   </td>
   <td>Application-specific message
   </td>
  </tr>
  <tr>
   <td>224
   </td>
   <td>LoRaWAN MAC layer test protocol
   </td>
  </tr>
  <tr>
   <td>255
   </td>
   <td>Reserved for future use
   </td>
  </tr>
</table>


If the **FRMPaylod **field contains MAC commands or application data, the **FRMPayload **must be encrypted before the **Message Integrity Code (MIC)** is calculated. The following table shows which key is used to encrypt the **FRMPayload **field in different LoRaWAN versions. This ensures the message **confidentiality**.

Table: FRMPayload field encryption keys


<table>
  <tr>
   <td><strong>FRMPayload</strong>
   </td>
   <td><strong>FPort</strong>
   </td>
   <td><strong>1.0.x</strong>
   </td>
   <td><strong>1.1</strong>
   </td>
  </tr>
  <tr>
   <td>MAC Commands
   </td>
   <td>0
   </td>
   <td>NwkSKey
   </td>
   <td>NwkSEncKey
   </td>
  </tr>
  <tr>
   <td>Application-specific data
   </td>
   <td>1 to 223
   </td>
   <td>AppSKey
   </td>
   <td>AppSKey
   </td>
  </tr>
</table>



## Calculating Message Integrity Code

The Message Integrity Code (MIC) ensures the **integrity and authenticity** of a message. The message integrity code is calculated over all the fields in the message. Next, the calculated MIC is added to the message. The following list shows what fields are used to calculate the MIC for each message type.



*   Data messages: MHDR | FHDR | FPort |FRMPayload
*   Join-request messages: MHDR | JoinEUI | DevEUI | DevNonce
*   Join-accept messages: MHDR | JoinNonce | NetID | DevAddr | DLSettings | RxDelay | CFList
*   Rejoin-request Type 0 and 2 messages: MHDR | Rejoin Type | NetID | DevEUI | RJcount0
*   Rejoin-request Type 1 messages:  MHDR | Rejoin Type | JoinEUI| DevEUI | RJcount1

The following table presents which key is used to calculate the MIC of each data message type.


<table>
  <tr>
   <td><strong>LoRaWAN version</strong>
   </td>
   <td><strong>Message Type</strong>
   </td>
   <td><strong>MIC is calculated using</strong>
   </td>
  </tr>
  <tr>
   <td>1.0.x
   </td>
   <td>Join request
   </td>
   <td>AppKey
   </td>
  </tr>
  <tr>
   <td>1.0.x
   </td>
   <td>Join accept
   </td>
   <td>AppKey
   </td>
  </tr>
  <tr>
   <td>1.0.x
   </td>
   <td>Uplink data message
   </td>
   <td>NwkSKey
   </td>
  </tr>
  <tr>
   <td>1.0.x
   </td>
   <td>Downlink data messages
   </td>
   <td>NwkSKey
   </td>
  </tr>
  <tr>
   <td>1.1
   </td>
   <td>Join accept
   </td>
   <td>If triggered by join request -> NwkKey
<p>
If triggered by rejoin request -> JSIntKey
   </td>
  </tr>
  <tr>
   <td>1.1
   </td>
   <td>Uplink data messages
   </td>
   <td>If the end device is connected to a LoRaWAN 1.0 network server then, FNwkSIntKey
<p>
If the end device is connected to a LoRaWAN 1.1 network server then, SNwkSIntKey
   </td>
  </tr>
  <tr>
   <td>1.1
   </td>
   <td>Downlink data message
   </td>
   <td>SNwkSIntKey
   </td>
  </tr>
</table>



## Questions



1. _The MAC commands can be transported in,_
    1. _<span style="text-decoration:underline;">FOpts</span>_
    2. _FCtrl_
    3. _FCnt_
    4. _FPort_
2. _The application payload can be transported in,_
    5. _<span style="text-decoration:underline;">FRMPayload</span>_
    6. _FOpts_
    7. _FPort_
    8. _FCtrl_
3. _Which field allows to transport application payload or MAC commands?_
    9. _<span style="text-decoration:underline;">FRMPayload</span>_
    10. _FOpts_
    11. _FPort_
    12. _FCtrl_
4. _If the FRMPayload transport MAC commands in LoRaWAN 1.0.x, the FRMPayload field must be encrypted using,_
    13. _ <span style="text-decoration:underline;">NwkSKey</span>_
    14. _AppSKey_
    15. _NwkSEncKey_
5. _If the FRMPayload transport application-specific data in LoRaWAN 1.0.x, the FRMPayload field must be encrypted using,_
    16. _ NwkSKey_
    17. _<span style="text-decoration:underline;">AppSKey</span>_
    18. _NwkSEncKey_
6. _If the FRMPayload transport MAC commands in LoRaWAN 1.1, the FRMPayload field must be encrypted using,_
    19. _ NwkSKey_
    20. _AppSKey_
    21. _<span style="text-decoration:underline;">NwkSEncKey</span>_
7. _If the FRMPayload transport application-specific data in LoRaWAN 1.1, the FRMPayload field must be encrypted using,_
    22. _ NwkSKey_
    23. _<span style="text-decoration:underline;">AppSKey</span>_
    24. _NwkSEncKey_
8. _Which message initiates the OTAA procedure?_
    25. _<span style="text-decoration:underline;">Join-request message</span>_
    26. _Join-accept message_
    27. _Rejoin-request message_
    28. _Uplink data message_